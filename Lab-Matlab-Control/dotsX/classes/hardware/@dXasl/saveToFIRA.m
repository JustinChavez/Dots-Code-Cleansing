function a_ = save(a_)%saveToFIRA method for class dXasl: copy data to FIRA data record%   a_ = save(a_)%%   Many non-graphics DotsX classes can copy important data to FIRA, a%   a global data record accompanied by analysis tools.%%   Some classes, such as hardware classes, return updated instances.%%----------Special comments-----------------------------------------------%-%%-% addToFIRA method for class dXasl.%-% Called by dXtask/trial at the end of a trial to%-%   write current values to FIRA%----------Special comments-----------------------------------------------%%   See also saveToFIRA dXasl% Copyright 2005 by Joshua I. Gold%   University of Pennsylvania% call buildFIRA_addTrial to add the data to the current% (last) trial in FIRA% Add a new column to the values.  Correct for frame integer overruns,% convert frame numbers to seconds, and align to trial wrt.vals = a_.values;if size(vals,2) >= 4    % get time, starting with 0    time = vals(:,4)-vals(1,4);    % correct integer overruns    over = find(time < 0, 1, 'first');    if ~isempty(over)        time(over:end) = ...            time(over:end) - time(over) + time(over-1) + 1;    end    % align time to trial wrt time in seconds    global FIRA    eWrt = strcmp(FIRA.ecodes.name, 'trial_wrt');    eBegin = strcmp(FIRA.ecodes.name, 'trial_begin');    wrtOffset = FIRA.ecodes.data(end,eWrt) - FIRA.ecodes.data(end,eBegin);    time = (time / a_.freq) - wrtOffset;    % add new time column    vals = cat(2, vals, time);end% save vals, regardless of time columnbuildFIRA_addTrial(a_.FIRAdataType, {vals});